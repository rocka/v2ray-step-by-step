(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{449:function(e,t,a){"use strict";a.r(t);var s=a(43),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"android-root-free-running-core"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#android-root-free-running-core"}},[e._v("#")]),e._v(" Android Root-free running core")]),e._v(" "),a("p",[e._v("Android runs V2Ray-core without Root permission and configures global proxy")]),e._v(" "),a("p",[e._v("This method is suitable for users who do not frequently change the configuration and the device does not have root permissions")]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("Preparation tools:")]),e._v(" "),a("ul",[a("li",[e._v("computer")]),e._v(" "),a("li",[e._v("adb environment")]),e._v(" "),a("li",[e._v("Data cable (used to connect the device to the computer)")])]),e._v(" "),a("p",[e._v("Required skills:")]),e._v(" "),a("ul",[a("li",[e._v("Learn about APN settings")]),e._v(" "),a("li",[e._v("Some practical Linux experience")]),e._v(" "),a("li",[e._v("Able to [compile V2Ray-core] (https://www.v2fly.org/developer/intro/compile.html#%E5%A4%9A%E7%A7%8D%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F)")]),e._v(" "),a("li",[e._v("Able to set the environment variables of the operating system you are using")])]),e._v(" "),a("p",[e._v("Tested terminal environment:")]),e._v(" "),a("ul",[a("li",[e._v("Android 10")]),e._v(" "),a("li",[e._v("ARM V8")])]),e._v(" "),a("p",[e._v("Disadvantages:")]),e._v(" "),a("p",[e._v("Since the files are stored in the temporary directory, the files will be deleted after the device restarts, so you need to reset the settings after restarting")]),e._v(" "),a("blockquote",[a("p",[e._v("By the way, in 2020, no one will restart the phone from time to time, right?")])]),e._v(" "),a("h2",{attrs:{id:"preparation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preparation"}},[e._v("#")]),e._v(" Preparation")]),e._v(" "),a("p",[e._v("Since there is no "),a("code",[e._v("/etc/resolv.conf")]),e._v(" in the Android system and no Root permission, it cannot be created;")]),e._v(" "),a("p",[e._v("Because the file cannot be read, the Go language uses the default address "),a("code",[e._v("127.0.0.1:53")]),e._v(" (but Android does not have a local DNS for 53), but it cannot be used because of system restrictions that cannot monitor the lower port number\nV2Ray handles this problem; therefore, running "),a("code",[e._v("core")]),e._v(" directly will cause DNS resolution problems due to the influence of the Go language (Android)")]),e._v(" "),a("p",[e._v("The solution is as follows:")]),e._v(" "),a("p",[e._v("You only need to modify one line of code, find the installation location of the Go language, and edit "),a("code",[e._v("src/net/dnsconfig_unix.go")]),e._v(", at line 19 (go version go1.15.6)")]),e._v(" "),a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[e._v("defaultNS "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"127.0.0.1:53"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"[::1]:53"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("Here is changed to Alibaba’s DNS, or it can be changed to other")]),e._v(" "),a("p",[e._v("Examples are as follows:")]),e._v(" "),a("div",{staticClass:"language-vim extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[e._v("defaultNS "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"223.5.5.5:53"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"[2400:3200::1]:53"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("Just save, and then you can start "),a("a",{attrs:{href:"#compile"}},[e._v("compile")]),e._v(", and then change back to")]),e._v(" "),a("h2",{attrs:{id:"compile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compile"}},[e._v("#")]),e._v(" Compile")]),e._v(" "),a("p",[e._v("You cannot use the "),a("code",[e._v("linux-armXXX")]),e._v(" in "),a("a",{attrs:{href:"https://github.com/v2fly/v2ray-core/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("precompilation"),a("OutboundLink")],1),e._v(", otherwise [this problem](https://github.com/ v2ray/discussion/issues/555)")]),e._v(" "),a("p",[e._v("Go language mainly uses "),a("code",[e._v("GOOS")]),e._v(" and "),a("code",[e._v("GOARCH")]),e._v(" to control the compilation environment")]),e._v(" "),a("h3",{attrs:{id:"environment-variable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#environment-variable"}},[e._v("#")]),e._v(" Environment variable")]),e._v(" "),a("p",[e._v("For ARM architecture, the default is ARM V8")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("SET "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("GOOS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("android\nSET "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("GOARCH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("arm64\n")])])]),a("p",[e._v("Other ARM architectures, such as V7")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("SET "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("GOOS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("android\nSET "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("GOARCH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("arm\nSET "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("GOARM")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("7")]),e._v("\n")])])]),a("p",[e._v("Enter the "),a("code",[e._v("v2ray-core")]),e._v(" directory, the complete command is as follows (Windows)")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("SET "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("CGO_ENABLED")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\nSET "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("GOOS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("android\nSET "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("GOARCH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("arm64\ngo build -o D:/v2ray -trimpath -ldflags "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"-s -w -buildid="')]),e._v(" ./main\ngo build -o D:/v2ctl -trimpath -ldflags "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"-s -w -buildid="')]),e._v(" -tags confonly ./infra/control/main\n")])])]),a("h2",{attrs:{id:"resource-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resource-storage"}},[e._v("#")]),e._v(" Resource storage")]),e._v(" "),a("p",[e._v("Put "),a("code",[e._v("v2ray")]),e._v(" and "),a("code",[e._v("v2ctl")]),e._v(" and your configuration files, geo resources, etc. into the internal storage of your phone")]),e._v(" "),a("p",[e._v('For example, "mobile phone internal storage/V2Ray" folder')]),e._v(" "),a("h2",{attrs:{id:"run-v2ray"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#run-v2ray"}},[e._v("#")]),e._v(" Run V2Ray")]),e._v(" "),a("h3",{attrs:{id:"connect-to-adb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#connect-to-adb"}},[e._v("#")]),e._v(" Connect to ADB")]),e._v(" "),a("p",[e._v('Connect the computer with a data cable, turn on the USB debugging of the device, and enable ADB debugging in the "charge only" mode; change the USB connection mode to "file transfer"')]),e._v(" "),a("p",[e._v("Open the terminal and enter the following command")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("adb devices\n")])])]),a("p",[e._v('If the phone prompts "Whether to allow USB debugging", check "Always allow..." and confirm')]),e._v(" "),a("p",[e._v("If the terminal displays as follows, the connection is successful")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("List of devices attached\n1234567C06011253        device\n")])])]),a("h3",{attrs:{id:"transfer-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#transfer-files"}},[e._v("#")]),e._v(" Transfer files")]),e._v(" "),a("p",[e._v("Continue to enter the following command, the terminal will become the identifier of the mobile phone at this time")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("adb shell\n")])])]),a("p",[e._v("Copy the V2Ray program in the internal storage of the device to the temporary directory of the device and give permission")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cp /sdcard/V2Ray/* /data/local/tmp/\ncd /data/local/tmp/\nchmod 777 v2*\n")])])]),a("p",[e._v("Try to run it; due to system limitations, it is recommended to use port numbers above "),a("code",[e._v("1024")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("./v2ray\n")])])]),a("p",[e._v("After the test is no problem, press "),a("code",[e._v("Ctrl+C")]),e._v(' to end the process, and then change the USB transfer mode to "charge only"')]),e._v(" "),a("p",[e._v("Then reconnect to the "),a("code",[e._v("/data/local/tmp")]),e._v(" directory")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),a("p",[e._v('It is measured that in the "transfer file" mode, the background will hang up as long as you disconnect it, but not in the charging mode.')])]),e._v(" "),a("p",[e._v("Run V2Ray in the background")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nohup")]),e._v(" ./v2ray "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("\n")])])]),a("p",[e._v("At this point, open the task manager, find the process named "),a("code",[e._v("adb")]),e._v(", and end it; if there are two processes in Windows, end the second one")]),e._v(" "),a("p",[e._v("This way, you can avoid the problem of program hanging after disconnection")]),e._v(" "),a("h2",{attrs:{id:"global-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#global-proxy"}},[e._v("#")]),e._v(" Global proxy")]),e._v(" "),a("p",[e._v("Open your APN settings. Since the default APN cannot be changed, you need to create a new one. Just copy the default one.")]),e._v(" "),a("p",[e._v("Then fill in "),a("code",[e._v("127.0.0.1")]),e._v(' in the "Proxy" column, the port number is your port number, save it')]),e._v(" "),a("p",[e._v("Go back to the upper setting and select this APN")]),e._v(" "),a("p",[e._v("All done.")]),e._v(" "),a("h2",{attrs:{id:"other"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#other"}},[e._v("#")]),e._v(" other")]),e._v(" "),a("p",[e._v("The actual measurement is very power-saving, and I can’t feel the existence of "),a("code",[e._v("core")]),e._v(" at all; I personally feel that the response speed is much faster than that of the shell")]),e._v(" "),a("p",[e._v("For the game, the actual measurement will not affect the champion, of course it may be related to the diversion, so I won’t repeat it here.")]),e._v(" "),a("h3",{attrs:{id:"test-version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-version"}},[e._v("#")]),e._v(" test version")]),e._v(" "),a("p",[e._v("go version go1.15.6 windows/amd64")]),e._v(" "),a("p",[e._v("v2fly/v2ray-core master")])])}),[],!1,null,null,null);t.default=r.exports}}]);